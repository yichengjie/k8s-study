# version 0.0.1
FROM centos:7.9.2009
ENV REFRESHED_AT 2014-06-01
RUN curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
RUN yum install -y yum-utils device-mapper-persistent-data lvm2 wget java-1.8.0-openjdk.x86_64 git
ADD ./docker-ce.repo /etc/yum.repos.d/docker-ce.repo
RUN yum install docker-ce-19.03.11 -y
# env config
ENV JENKINS_HOME=/opt/jenkins/data
ENV JENKINS_MIRROR=http://mirrors.jenkins-ci.org
# 
RUN mkdir -p ${JENKINS_HOME}/plugins
RUN curl -sf -o /opt/jenkins/jenkins.war -L ${JENKINS_MIRROR}/war/2.54/jenkins.war
# 
ADD ./dockerjenkins.sh /usr/local/bin/dockerjenkins.sh
RUN chmod +x /usr/local/bin/dockerjenkins.sh

VOLUME [ "/var/lib/docker" ]

EXPOSE 8080

ENTRYPOINT ["/usr/local/bin/dockerjenkins.sh"]